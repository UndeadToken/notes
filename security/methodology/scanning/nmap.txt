Scan from file where IPADDR is the host list
nmap -oG - 192.168.1.0-255 -p 22  -vv > /home/SCAN
cat SCAN | grep Up | awk -F " " '{print $2}' > IPADDR
nmap -iL IPADDR

multiple hosts:
192.168.1.0-255
192.168.1.0/255

query ip location:
curl ipinfo.io/IP_ADDRESS

-s determines what type of scan to perform, adding T defines a tcp scan.

scan all ports: -p-
disable host discovery: -Pn (scan every system as if it were alive)
tcp connect: nmap -sT -p- -Pn IPADDR

specify ip range: IPADDR-RANGE e.g. 192.168.1.101-254

skip ip ranges  that end in .0 or .255
192.168.0-255.1-254

--exclude, --excludefile <filename>

test run: nmap -sL -n <ip>

Choose targets at random
-iR <numtargets>

SYN scan -sS
UDP scan: -sU
version: -sV
udp + version: -sUV
xmas: -sX
null: -sN
time: -T 0-5
list: -sL
window: -sW
Maimon: -sM
Idle: -sI <zombie host>
IP: -sO
TCP FTP Bounce: -b <FTP bounce proxy>
fingerprinting: -0

NSE script categories:
auth, broadcast, default, discovery, dos, exploit,external,fuzzer,intrusive,malware,safe,version and vuln.
e.g. nmap --script banner IPADDR
nmap.org/nsdoc

OSVDP (Open source vulnerability Database)

---

The default uses a simple echo request and an ACK to port 80. A more extensive approach would be to..

-PS{port},{port},{port} TCP SYN packet to ports ..
-PA{port},{port},{port} TCP ACK packet to ports ..
-PU{port},.. UDP packet to ports ..
-PR ARP scan
-PE ICMP echo request packet - Nmap sends ICMP type 8 (echo request) and expects ICMP type 0 (echo reply)
  alternatively ICMP code 14 (timestamp -PP) and ICMP code 18 (address mask -PM) replies indicates an up host 

-PN scan host as if it were alive.

IP Protocol Ping
-PO
default ICMP(protocol 1), IGMP(protocol 2) and IP-in-IP(protocol 4)
TCP = protocol 6
UDP = protocol 17

Advanced and aggresive features.
version detection, Nmap Scripting Engine, remote OS detection, and traceroute.
-A same as (-sV -C -O --traceroute) 

-T4 Adjust timing to the aggressive level (#4 of 5), same as -T aggressive (also, polite insane)

-oA {scan} - outputes results in every format(normal ,XML, grepable)

locate random random webservers:
nmap -sS -PS80 -iR 0 -p80

state based firewalls:
INVALID - packet is associated with no know packet
ESTABLISHED - packet is associated with a connection which has seen packets in both directions
NEW - packet has started a new connection
RELATED - packet is starting a new connection

Raw IP scan of offline target: nmap -n -sP --send-ip {host}
ARP scan of offline target: nmap -n -PR --packet-trace --send-eth {host} or nmap -n --packet-trace {host}

spoof MAC: --spoof-mac

CIDR(classesless inter-domain routing)
IANA (Internet Assigned Numbers Authority)






---

cat tcp.dat | grep open | awk 'gsub("/tcp", ",") {print $1 $3}'

#!/usr/bin/bash

host=$1

nmap -sT -p- -Pn 192.168.1.104 > tcp.dat
cat tcp.dat | grep open | awk 'gsub("/tcp", "") {print $1}' > tcp.ports.dat

services=`cat tcp.ports.dat`

for port in $services; do
	echo Scanning $host:$port
	nmap -sT -p$port -Pn $host --script vuln > tcp.$port.dat
done


